# /etc/ntpsec/ntp.conf generated by xrobau/rpi-ntp

driftfile /var/lib/ntpsec/ntp.drift
leapfile /usr/share/zoneinfo/leap-seconds.list

# To enable Network Time Security support as a server, obtain a certificate
# (e.g. with Let's Encrypt), configure the paths below, and uncomment:
# nts cert CERT_FILE
# nts key KEY_FILE
# nts enable

# You must create /var/log/ntpsec (owned by ntpsec:ntpsec) to enable logging.
statsdir /var/log/ntpsec/
statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

# We allow up to 20 peers. This is more than the default, and ntpsec will
# only care about the 'best' 4 (minclock 4, below), but in case of network
# peering outages, you'll have a good chance of surviving with SOME peers
# still accessible
tos maxclock 20

tos minclock 4 minsane 3

# GPS PPS reference (NTP1)
# https://docs.ntpsec.org/latest/driver_pps.html
#   unit 0 = /dev/pps0
#   flag2: 0 = Assert on RISING (default), 1 = Falling
#     Note you can only use 'flag2 1' if you have enabled
#     'assert_falling_edge=on' in /boot/config.txt (See the
#     documentation added in that file by this tool)
#   flag3:  Use kPPS instead of Userspace (default is 0/off)
#     https://docs.ntpsec.org/latest/driver_pps.html suggests
#     that the kPPS mode NOT be used, but it seems that this
#     documentation is slightly out of date, as it appears to
#     be more accurate, and have less jitter, when it's turned
#     on. YMMV.
#   flag4: Return timestamps every second for accuracy plots (default off)
#
refclock pps unit 0 refid PPS minpoll 0 maxpoll 4 flag2 0 flag3 1 flag4 1

refclock shm unit 0 refid GPS minpoll 0 maxpoll 4 time1 0.1315 stratum 1 prefer

# We only use 2.xx as the rest don't have IPv6 results
pool __POOL__ iburst

# If you're registered with the Au NMI servers,
# comment out the pool line, and uncomment these.
# Selet 'prefer' for the most accurate one, according
# to your location
#
#server ntp.sydney.nmi.gov.au prefer
#server ntp2.sydney.nmi.gov.au
#server ntp.melbourne.nmi.gov.au
#server ntp.perth.nmi.gov.au
#server ntp.adelaide.nmi.gov.au

# By default, exchange time with everybody, but don't allow configuration.
restrict default kod nomodify nopeer noquery limited

# Local users may interrogate the ntp server more closely.
restrict 127.0.0.1
restrict ::1
